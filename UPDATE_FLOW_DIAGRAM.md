# Update Flow Diagram

This document provides visual representations of how updates flow through the PISCOC1 CMS system.

---

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PISCOC1 CMS (This System)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   React Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Express Server  â”‚                  â”‚
â”‚  â”‚   (Frontend UI)  â”‚         â”‚   (API Backend)  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                             â”‚                             â”‚
â”‚           â”‚                             â–¼                             â”‚
â”‚           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   PostgreSQL DB   â”‚                 â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                     â”‚                     â”‚
                    â–¼                     â–¼                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Website    â”‚     â”‚   Airtable   â”‚     â”‚  Instagram   â”‚
            â”‚ (External)   â”‚     â”‚  (Optional)  â”‚     â”‚  (Optional)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Instant CMS Update Flow

**When:** Any content change (articles, team members, etc.)  
**Speed:** < 1 second

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              
â”‚   User   â”‚                                              
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              
     â”‚                                                    
     â”‚ 1. Clicks "Save"                                  
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  React Client   â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 2. POST /api/articles                            
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ Express Server  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 3. INSERT/UPDATE                                 
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  PostgreSQL DB  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 4. Return updated data                           
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ Express Server  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 5. Response with data                            
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  React Client   â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 6. queryClient.invalidateQueries()               
     â”‚ 7. Refetch data                                  
     â”‚ 8. Update UI                                     
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  UI Updates âš¡   â”‚                                      
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
```

---

## 2. Webhook to Website Flow

**When:** Published article created/edited/deleted  
**Speed:** < 5 seconds

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              
â”‚   User   â”‚                                              
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              
     â”‚                                                    
     â”‚ 1. Publishes article                              
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  React Client   â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 2. PUT /api/articles/:id                         
     â”‚    { status: "published" }                        
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ Express Server  â”‚                                      
â”‚  routes.ts      â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 3. Update DB                                     
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  PostgreSQL DB  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 4. Article updated                               
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ Express Server  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 5. Call notifyArticlePublished()                 
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ webhookNotifier â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 6. POST to ARTICLE_WEBHOOK_URL                   
     â”‚    { action: "published",                        
     â”‚      articleId: 123,                             
     â”‚      timestamp: "..." }                          
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚    Website      â”‚                                      
â”‚   (External)    â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 7. Receives webhook                              
     â”‚ 8. Refreshes cache                               
     â”‚ 9. Updates content                               
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ Website shows    â”‚                                      
â”‚ new article âš¡   â”‚                                      
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
```

---

## 3. Scheduled Publication Flow (with Airtable)

**When:** Article scheduled for future publication  
**Speed:** 0-60 second delay after scheduled time

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              
â”‚   User   â”‚                                              
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              
     â”‚                                                    
     â”‚ 1. Creates article with                           
     â”‚    Scheduled: "2025-11-23 14:30"                  
     â”‚    Status: "pending"                              
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  PostgreSQL DB  â”‚                                      
â”‚  (Article saved)â”‚                                      
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
                                                          
          ... Time passes ...                            
          Current time: 14:30:45                         
                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚   Scheduler     â”‚ â—„â”€â”€ Runs every 60 seconds            
â”‚  (Background)   â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 2. Checks for articles where                     
     â”‚    Scheduled <= NOW                               
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  PostgreSQL DB  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 3. Found article (id: 123)                       
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚   Scheduler     â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 4. ensureArticleOnAirtable()                     
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚    Airtable     â”‚                                      
â”‚  (If configured)â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 5. Article synced                                
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚   Scheduler     â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 6. publishArticle()                              
     â”‚    - Update status to "published"                
     â”‚    - Set publishedAt to NOW                      
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚  PostgreSQL DB  â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 7. Article updated                               
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚   Scheduler     â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 8. notifyArticlePublished()                      
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚    Website      â”‚                                      
â”‚   (Webhook)     â”‚                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
     â”‚                                                    
     â”‚ 9. Website updates                               
     â–¼                                                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      
â”‚ Article appears  â”‚                                      
â”‚ on website â±ï¸    â”‚                                      
â”‚ (0-60s delay)   â”‚                                      
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
```

---

## 4. Update Types Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Update Type       â”‚  Speed   â”‚  Triggers   â”‚  Affects Website    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CMS UI              â”‚ âš¡ < 1s   â”‚ All changes â”‚ No (CMS only)       â”‚
â”‚                     â”‚          â”‚             â”‚                     â”‚
â”‚ Webhook to Website  â”‚ âš¡ < 5s   â”‚ Published   â”‚ âœ… Yes - Instant    â”‚
â”‚                     â”‚          â”‚ articles    â”‚                     â”‚
â”‚                     â”‚          â”‚ only        â”‚                     â”‚
â”‚                     â”‚          â”‚             â”‚                     â”‚
â”‚ Scheduled Publish   â”‚ â±ï¸ 0-60s â”‚ Scheduled   â”‚ âœ… Yes - After      â”‚
â”‚ (via Scheduler)     â”‚          â”‚ date/time   â”‚    0-60s delay      â”‚
â”‚                     â”‚          â”‚             â”‚                     â”‚
â”‚ Manual Airtable     â”‚ ğŸ”„ On    â”‚ Admin       â”‚ No (unless website  â”‚
â”‚ Sync                â”‚ demand   â”‚ trigger     â”‚ uses Airtable)      â”‚
â”‚                     â”‚          â”‚             â”‚                     â”‚
â”‚ Instagram Post      â”‚ âš¡ < 10s  â”‚ Article     â”‚ No (separate        â”‚
â”‚                     â”‚          â”‚ published   â”‚ platform)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Decision Tree: Will My Change Update the Website?

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Made a change    â”‚
                    â”‚  in the CMS       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Is it an         â”‚
              â”Œâ”€â”€â”€â”€â”€â”¤  article?         â”œâ”€â”€â”€â”€â”€â”
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
              â”‚ Yes                       No  â”‚
              â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Is the article   â”‚         â”‚  Changes only      â”‚
    â”‚  published?       â”‚         â”‚  visible in CMS    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  (not on website)  â”‚
              â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚ Yes   No  â”‚
        â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Website   â”‚ â”‚ âŒ Website won't   â”‚
â”‚ will update  â”‚ â”‚ update until       â”‚
â”‚ via webhook  â”‚ â”‚ article is         â”‚
â”‚ (< 5s)       â”‚ â”‚ published          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Future publication
                         â”‚ date set?
                         â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚ Yes  No â”‚
                    â–¼         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ âœ… Will  â”‚ â”‚ âŒ Won't â”‚
            â”‚ publish  â”‚ â”‚ publish  â”‚
            â”‚ when     â”‚ â”‚ until    â”‚
            â”‚ scheduledâ”‚ â”‚ you      â”‚
            â”‚ (0-60s   â”‚ â”‚ manually â”‚
            â”‚ delay)   â”‚ â”‚ publish  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Troubleshooting Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Website not updating? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check: Is article     â”‚
â”‚ status "published"?   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚ No      Yes â”‚
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Publish â”‚  â”‚ Check: Is        â”‚
â”‚ article â”‚  â”‚ ARTICLE_WEBHOOK_ â”‚
â”‚ to      â”‚  â”‚ URL configured?  â”‚
â”‚ trigger â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ update  â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
               â”‚ No      Yes â”‚
               â–¼             â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Set env â”‚  â”‚ Check server â”‚
          â”‚ variableâ”‚  â”‚ logs for     â”‚
          â”‚ and     â”‚  â”‚ webhook      â”‚
          â”‚ restart â”‚  â”‚ errors       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                       â”‚ Errors? No  â”‚
                       â–¼             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Check  â”‚    â”‚ Check if    â”‚
                  â”‚ webhookâ”‚    â”‚ website is  â”‚
                  â”‚ URL is â”‚    â”‚ processing  â”‚
                  â”‚ correctâ”‚    â”‚ webhooks    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Data Flow Between Systems

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      PISCOC1 CMS (Source)       â”‚
                    â”‚                                 â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚    PostgreSQL Database   â”‚   â”‚
                    â”‚  â”‚  (Single source of truth)â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚              â”‚
                    â”‚              â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Airtable       â”‚      â”‚      â”‚   Website        â”‚
        â”‚   (Optional      â”‚      â”‚      â”‚   (Consumes      â”‚
        â”‚    Secondary     â”‚      â”‚      â”‚    via API or    â”‚
        â”‚    Storage)      â”‚      â”‚      â”‚    Webhooks)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Instagram      â”‚
                          â”‚   (Publishes     â”‚
                          â”‚    Content)      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flow Direction:
  CMS â†’ Airtable:    Scheduled sync (60s) or manual
  CMS â†’ Website:     Webhook on publish (instant)
  CMS â†’ Instagram:   Auto-post on publish (instant)
  
Note: Website pulls from CMS, not from Airtable
```

---

## 8. Webhook Payload Structure

**Webhook payload example:**
```json
{
  "action": "published",
  "articleId": 123,
  "timestamp": "2025-11-23T21:00:00.000Z"
}
```

**Possible action values:**
- `"published"` - Article was just published
- `"edited"` - Published article was edited
- `"deleted"` - Published article was deleted

**HTTP Request Example:**
```
POST https://your-website.com/api/webhooks/article-published
Content-Type: application/json
User-Agent: PISCOC1-Webhook/1.0

{
  "action": "published",
  "articleId": 123,
  "timestamp": "2025-11-23T21:00:00.000Z"
}
```

> **Note:** Replace `https://your-website.com/api/webhooks/article-published` with your actual webhook URL configured in `ARTICLE_WEBHOOK_URL` environment variable.

---

## Summary

- **CMS Changes**: Always instant in the CMS UI
- **Website Updates**: Instant for published articles (via webhooks)
- **Draft Changes**: Not visible on website until published
- **Scheduled Articles**: Published 0-60 seconds after scheduled time
- **Airtable**: Used for backup/sync, not primary website data source

The key takeaway: **Publish your articles to make them visible on the website instantly!**
